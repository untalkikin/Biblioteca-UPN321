{% extends "base.html" %}
{% block title %}Catálogo{% endblock %}
{% block content %}
<h1 class="h3 mb-3">Catálogo</h1>
<form class="row g-2 mb-3">
  <div class="col-sm-6">
    <input class="form-control" type="search" name="q" value="{{ q }}" placeholder="Título, autor, ISBN, tema…">
  </div>
  <div class="col-sm-2">
    <input class="form-control" name="lcc" value="{{ lcc }}" placeholder="Clase LCC (ej. QA)">
  </div>
  <div class="col-sm-2">
    <select class="form-select" name="type">
      <option value="">Tipo…</option>
      <option value="book" {% if type == 'book' %}selected{% endif %}>Libro</option>
      <option value="thesis" {% if type == 'thesis' %}selected{% endif %}>Tesis</option>
      <option value="article" {% if type == 'article' %}selected{% endif %}>Artículo</option>
      <option value="other" {% if type == 'other' %}selected{% endif %}>Otro</option>
    </select>
  </div>
  <div class="col-sm-2 d-grid">
    <button class="btn btn-primary">Buscar</button>
  </div>
</form>

<div class="d-flex justify-content-end mb-3">
  {% if user.is_authenticated %}
    <a class="btn btn-success" href="{% url 'catalog:record_create' %}">+ Nuevo registro</a>
  {% endif %}
</div>

<div class="list-group">
  {% for r in records %}
  <a class="list-group-item list-group-item-action" href="{% url 'catalog:record_detail' pk=r.pk %}">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">{{ r.title }}</h5>
      <small class="text-muted">{{ r.call_number }}</small>
    </div>
    {% if r.subtitle %}<p class="mb-1">{{ r.subtitle }}</p>{% endif %}
    <small>
      {% for c in r.contributors.all|slice:":3" %}{{ c.person.full_name }}{% if not forloop.last %}, {% endif %}{% endfor %}
      {% if r.publish_year %} · {{ r.publish_year }}{% endif %}
      {% if r.publisher %} · {{ r.publisher.name }}{% endif %}
    </small>
  </a>
  {% empty %}
  <div class="alert alert-info">No hay resultados.</div>
  {% endfor %}
</div>

<nav class="mt-3">
  <ul class="pagination">
    {% if records.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ records.previous_page_number }}&q={{ q }}&lcc={{ lcc }}&type={{ type }}">Anterior</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Página {{ records.number }} de {{ records.paginator.num_pages }}</span></li>
    {% if records.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ records.next_page_number }}&q={{ q }}&lcc={{ lcc }}&type={{ type }}">Siguiente</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
